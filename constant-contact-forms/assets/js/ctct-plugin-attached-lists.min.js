!function(){var e={633:function(){window.CMBAP=window.CMBAP||{},function(e,t,s,i){i.$={},i.cache=function(){var e=s(".attached-posts-wrap");i.$.retrievedPosts=e.find(".retrieved"),i.$.attachedPosts=e.find(".attached")},i.init=function(){i.cache(),i.makeDraggable(),i.makeDroppable(),s(".cmb2-wrap > .cmb2-metabox").on("click",".attached-posts-wrap .retrieved .add-remove",i._moveRowToAttached).on("click",".attached-posts-wrap .attached .add-remove",i._removeRowFromAttached).on("keyup",".attached-posts-wrap input.search",i._handleFilter).on("click",".cmb-type-custom-attached-posts .cmb-td .cmb2-attached-posts-search-button",i._openSearch),s(t.body).on("click",".ui-find-overlay",i.closeSearch)},i.makeDraggable=function(){i.$retrievedPosts().draggable({helper:"clone",revert:"invalid",stack:".retrieved li",stop:i.replacePlusIcon})},i.makeDroppable=function(){i.$.attachedPosts.droppable({accept:".retrieved li",drop:function(e,t){i.buildItems(t.draggable)}}).sortable({stop:function(e,t){i.resetItems(t.item)}}).disableSelection()},i.buildItems=function(e){var t=s(e).parents(".attached-posts-wrap"),a=e[0].attributes[0].value;i.inputHasId(t,a)||(t.find('.retrieved li[data-id="'+a+'"]').addClass("added"),e.clone().appendTo(t.find(".attached")),i.resetAttachedListItems(t))},i._moveRowToAttached=function(){i.moveRowToAttached(s(this).parent())},i.moveRowToAttached=function(e){if(!e.hasClass("added")){var t=e.data("id"),s=e.parents(".attached-posts-wrap");i.inputHasId(s,t)||(e.addClass("added"),s.find(".attached").append(e.clone()),i.resetAttachedListItems(s))}},i._removeRowFromAttached=function(){i.removeRowFromAttached(s(this).closest("li"))},i.removeRowFromAttached=function(e){var t=e.data("id"),s=e.parents(".attached-posts-wrap");e.remove(),s.find('.retrieved li[data-id="'+t+'"]').removeClass("added"),i.resetAttachedListItems(s)},i.inputHasId=function(e,t){var a=i.getPostIdsInput(e),n=i.getPostIdsVal(a);return-1!==s.inArray(t,n)},i.getPostIdsInput=function(e){return e.find(".attached-posts-ids")},i.getPostIdsVal=function(e){var t=e.val();return t?t.split(","):[]},i.resetAttachedListItems=function(e){var t=i.getPostIdsInput(e),a=[];e.find(".attached li").each(function(e){var t=0==e%2?"odd":"even";a.push(s(this).attr("class",t+" ui-sortable-handle").data("id"))}),i.replacePlusIcon(),t.val(a.join(","))},i.resetItems=function(e){var t=s(e);i.resetAttachedListItems(t.parents(".attached-posts-wrap"))},i.replacePlusIcon=function(){s(".attached li .dashicons.dashicons-plus").removeClass("dashicons-plus").addClass("dashicons-minus")},i._handleFilter=function(e){var t=s(e.target);i.handleFilter(t.val()||"",t.closest(".column-wrap"))},i.handleFilter=function(e,t){e=e?e.toLowerCase():"",t.find("ul.connected li").each(function(){var t=s(this);t.text().toLowerCase().search(e)>-1?t.show():t.hide()})},i.rowTmpl=function(e){return'<li data-id="'+e.id+'" class="'+e.class+' ui-draggable ui-draggable-handle"><span class="dashicons dashicons-sort sort"></span>'+e.title+'<span class="dashicons dashicons-plus add-remove"></span></li>'},i.$retrievedPosts=function(){return i.$.retrievedPosts.find("li")},i.$lastRow=function(){var e=i.$retrievedPosts().last();return i.editTitle||(i.editTitle=e.find("a").attr("title")),e},i.SearchView=e.Backbone.View.extend({el:"#find-posts",overlaySet:!1,$overlay:!1,$button:!1,events:{"keypress .find-box-search:input":"maybeStartSearch","keyup #find-posts-input":"escClose","click #find-posts-submit":"selectPost","click #find-posts-search":"send","click #find-posts-close":"close"},initialize:function(){this.$spinner=this.$el.find(".find-box-search .spinner"),this.$input=this.$el.find("#find-posts-input"),this.$response=this.$el.find("#find-posts-response"),this.$overlay=s(".ui-find-overlay"),this.listenTo(this,"open",this.open),this.listenTo(this,"close",this.close)},escClose:function(e){e.which&&27===e.which&&this.close()},close:function(){this.$overlay.hide(),this.$el.hide()},open:function(){return this.$response.html(""),this.$el.show().find("#find-posts-head").html(this.findtxt+'<div id="find-posts-close"></div>'),this.$input.focus(),this.$overlay.length||(s("body").append('<div class="ui-find-overlay"></div>'),this.$overlay=s(".ui-find-overlay")),this.$overlay.show(),this.send(),!1},maybeStartSearch:function(e){if(13===e.which)return this.send(),!1},send:function(){this.$spinner.addClass("is-active");var e=i.$retrievedPosts().map(function(){return s(this).data("id")}).get(),t={ps:this.$input.val(),action:"find_posts",search_types:this.types,cmb_id:this.cmbId,group_id:this.groupId,field_id:this.fieldId,exclude:this.exclude,retrieved:e,_ajax_nonce:s("#find-posts #_ajax_nonce").val(),cmb2_attached_search:!0};s.post(i.ajaxurl,t).always(this.hideSpinner.bind(this)).done(this.ajaxSuccess.bind(this)).fail(this.ajaxFail.bind(this))},hideSpinner:function(){this.$spinner.removeClass("is-active")},ajaxSuccess:function(e){e.success||this.$response.text(this.errortxt);var t=e.data.replace(/type="radio"/gi,'type="checkbox"');this.$response.html(t)},ajaxFail:function(e){this.$response.text(this.errortxt)},selectPost:function(e){e.preventDefault();var t="",a=this.$response.find('input[type="checkbox"]:checked');if(a.length){var n=i.$lastRow(),o=n.hasClass("even")?"odd":"even",r=[];a.each(function(){r.push(this.value);var e=s(this).parents(".found-posts");t+=i.rowTmpl({title:e.find("label").html(),id:this.value,class:o}),o="even"===o?"odd":"even"}),t&&(n.after(t),i.makeDraggable(),this.moveInserted(r)),this.close()}else this.close()},moveInserted:function(e){setTimeout(function(){for(var t=0;t<=e.length;t++)i.moveRowToAttached(i.$retrievedPosts().filter('[data-id="'+e[t]+'"]'))},500)}}),i.search=new i.SearchView,i.closeSearch=function(){i.search.trigger("close")},i._openSearch=function(e){i.openSearch(s(e.currentTarget))},i.openSearch=function(e){i.search.$button=e,s.extend(i.search,i.search.$button.data("search")),i.search.trigger("open")},s(i.init)}(window,document,jQuery,window.CMBAP)}},t={};function s(i){var a=t[i];if(void 0!==a)return a.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,{a:t}),t},s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";s(633)}()}();
//# sourceMappingURL=ctct-plugin-attached-lists.min.js.map